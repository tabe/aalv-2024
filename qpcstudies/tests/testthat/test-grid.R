assert_grid <- function(x) {
    expect_s3_class(x, "data.frame")
    expect_named(x, c("f1", "f2"))
}

test_that("generate_grid", {
    g <- expect_silent(generate_grid(0.1, 1))
    assert_grid(g)
    expect_equal(nrow(g), 22)
    g <- expect_silent(generate_grid(0.1, 100))
    assert_grid(g)
    expect_equal(nrow(g), 373252)
    g <- expect_silent(generate_grid(0.1, 128))
    assert_grid(g)
    expect_equal(nrow(g), 612162)
    g <- expect_silent(generate_grid(0.2, 128))
    assert_grid(g)
    expect_equal(nrow(g), 152482)
    g <- expect_silent(generate_grid(0.25, 10))
    assert_grid(g)
    expect_equal(nrow(g), 532)
    g <- expect_silent(generate_grid(0.25, 128))
    assert_grid(g)
    expect_equal(nrow(g), 97410)
    g <- expect_silent(generate_grid(1/3, 128))
    assert_grid(g)
    expect_equal(nrow(g), 54626)
})

test_that("place_xbc_in_grid", {
    xbc <- cross_bicoherence(rnorm(100), rnorm(100), rnorm(100))
    r <- expect_silent(place_xbc_in_grid(xbc, 0.25, 10))
    expect_s3_class(r, "data.frame")
    expect_equal(nrow(r), 532)
    expect_equal(head(r$f1), rep(0.025, 6))
    expect_equal(head(r$f2), c(0.025, 0.05, 0.075, 0.1, 0.125, 0.15))
    expect_equal(tail(r$f1), rep(0.475, 6))
    expect_equal(tail(r$f2), c(-0.325, -0.35, -0.375, -0.4, -0.425, -0.45))
})
